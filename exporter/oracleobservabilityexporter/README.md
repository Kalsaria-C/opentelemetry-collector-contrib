# Oracle Observability Exporter
<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: logs   |
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aexporter%2Foracleobservability%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aexporter%2Foracleobservability) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aexporter%2Foracleobservability%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aexporter%2Foracleobservability) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=exporter_oracleobservability)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=exporter_oracleobservability&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    |  |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

The Oracle Observability Exporter is a component of the OpenTelemetry Collector that enables the export of logs to [OCI Logging Analytics](https://docs.oracle.com/en-us/iaas/logging-analytics/home.htm).

The exporter plugin uses OCI authentication and authorization (AuthN/AuthZ) to securely export data from the customer environment to the OCI Logging Analytics service.

## Configuration

The following settings are required:

- `namespace` (no default): The OCI tenancy namespace to which the collected log data will be uploaded.
- `log_group_id` (no default): The log group OCID to which the log data will be mapped. This is primarily used for authorization (AuthZ) purposes.
- `auth_type` (default: config_file): The authentication type to use. Supported values are:
  - `config_file`: Use OCI configuration file for authentication.
  - `instance_principal`: Use OCI instance principal for authentication. Recommended when the collector is deployed inside OCI environment.
- `oci_config_file_path` (no default): Path to the OCI configuration file. If `auth_type` is `config_file` and this filed is not provided, the exporter will look for the configuration in the default location ($HOME/.oci/config or the location specified by the OCI_CONFIG_FILE environment variable).
- `config_profile` (default: DEFAULT): The profile to be used in the OCI configuration file, if `auth_type` is `config_file`
- `private_key_passphrase` (no default): Passphrase for the private key used in the config file, if the key is password-protected. Only applicable when `auth_type` is `config_file`.
- `oci_config_file` (no default): An alternative way to provide the content of the OCI Config file, if `auth_type` is `config_file`. The following fields are required:
  - `fingerprint` (no default): The fingerprint of the OCI user.
  - `private_key` (no default): The private key of the OCI user.
  - `tenancy` (no default): The OCI tenancy OCID.
  - `region` (no default): The OCI region.
  - `user` (no default): The OCI user OCID.

NOTE: If both `oci_config_file_path` and `oci_config` are provided, the exporter will use `oci_config` over `oci_config_file_path`.

## OpenTelemetry Exporter Helper Configurations

The `oracleobservability` exporter supports OpenTelemetry Exporter Helper configurations, enabling enhanced control over request handling. It includes settings for `timeout`, `sending_queue`, and `retry_on_failure`, as provided by the [Exporter Helper](https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/exporterhelper#configuration).

### Timeout Configuration

`timeout` (default: 0): The maximum duration before a request times out. A timeout value of zero disables timeouts.

`timeout` option accept duration strings, valid time units are "ns" (nanoseconds), "us" or "µs" (microseconds), "ms" (milliseconds), "s" (seconds), "m" (minutes), and "h" (hours).

### Retry Configuration

The exporter supports automatic retries for failed requests.

`retry_on_failure`:

- `enabled` (default: true): If true, failed requests will be retried. If false, failed requests are discarded immediately with no retry attempts.
- `initial_interval` (default: 5s): The time to wait before the first retry attempt.
- `max_interval` (default: 30s): The maximum delay between consecutive retry attempts.
- `max_elapsed_time` (default: 0): The total time allowed for all retries. If 0, retries will continue indefinitely until the request succeeds.
- `multiplier` (default = 1.5): Factor by which the retry interval is multiplied on each attempt; ignored if enabled is false
- `randomization_factor` (default = 0.5): RandomizationFactor is a random factor used to calculate next backoffs.

The `initial_interval`, `max_interval` and `max_elapsed_time` options accept duration strings, valid time units are "ns" (nanoseconds), "us" or "µs" (microseconds), "ms" (milliseconds), "s" (seconds), "m" (minutes), and "h" (hours).

### Queue Configuration

The exporter supports a queueing mechanism to buffer logs before sending them.

`sending_queue`:

- `enabled` (default: true): If true, logs will be buffered in a queue before being sent. If false, logs are sent immediately to the consumer without buffering.
- `num_consumers` (default: 10): The number of consumers processing logs from the queue.
- `block_on_overflow` (default = false): If true, blocks the request until space is available in the queue. If set to false, the exporter immediately returns an error if the queue is full.
- `sizer` (default = requests): How the queue and batching is measured. Available options:
  - `requests`: number of incoming batches of metrics, logs, traces (the most performant option);
  - `items`: number of the smallest parts of each signal (spans, metric data points, log records);
  - `bytes`: the size of serialized data in bytes (the least performant option).
- `queue_size` (default: 1000): The maximum number of logs that can be buffered before older logs are dropped.
- `batch` (default: disabled): It only supports if `sizer` is set as `items` or `bytes`.
  - `flush_timeout`: time after which a batch will be sent regardless of its size. Must be a non-zero value
  - `min_size`: the minimum size of a batch.
  - `max_size`: the maximum size of a batch, enables batch splitting. The maximum size of a batch should be greater than or equal to the minimum size of a batch.
- `storage` (default = 'file_storage'): When set, enables persistence and uses the component specified as a storage extension for the persistent queue. There is no in-memory queue when set. The file_storage extension must be explicitly configured in config.yaml under extensions: and included in service::extensions for it to take effect. More information regarding filestorage extension can be found at [File Storage Extension](https://pkg.go.dev/github.com/open-telemetry/opentelemetry-collector-contrib/extension/storage/filestorage).

## Recommendations

It is recommend to configure `memory_limiter` and `batch` processor. More info on memory limiter processor can be found at [Memory Limiter Processor](https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/memorylimiterprocessor/README.md?plain=1) and batch processor can be found at [Batch Processor](https://github.com/open-telemetry/opentelemetry-collector/tree/main/processor/batchprocessor).

Example Configuration:

```yaml
exporters:
  oracleobservability:
    namespace: "my_namespace"
    log_group_id: "ocid1.loggroup.oc1..example"
    auth_type: "config_file"
    oci_config_file_path: "/path/to/oci/config"
    config_profile: "DEFAULT"
    timeout: 10s
    sending_queue:
      enabled: true
      queue_size: 5000
      num_consumers: 12
    retry_on_failure:
      enabled: true
      initial_interval: 10s
      max_interval: 40ss

processors:
  memory_limiter:
    # Assume 2000 mb of RAM for OTel Collector
    check_interval: 1s
    limit_mib: 1500
    spike_limit_mib: 400

  batch:
    timeout: 5s
    send_batch_size: 100
    
extensions:
  file_storage:
    directory: /tmp/otel
    timeout: 1s                      
    create_directory: true
    directory_permissions: "0777"
    fsync: true

service:
  extensions: [file_storage]
  pipelines:
    logs:
      receivers: [<receiver(s)>]
      processors: [<processor(s)>]
      exporters: [oracleobservability]
```

## Validation

The exporter configuration is validated to ensure that all required fields are provided and that the configuration is valid. If required fields are missing or the configuration is invalid, the exporter fails to start and returns an appropriate error message.
